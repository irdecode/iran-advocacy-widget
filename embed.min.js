!function(){"use strict";const e="1.0.0",t={widgetUrl:"https://irdecode.com/widget",containerId:"iran-advocacy-widget",defaultWidth:"100%",defaultHeight:"800px",borderRadius:"12px",boxShadow:"0 25px 50px -12px rgba(0,0,0,0.25)",allowedOrigins:["https://irdecode.com"],debug:!1};function i(e,i="info"){t.debug&&console[i]("[Iran Widget]",e)}function n(e,n){i(e,"error"),console.error("[Iran Widget Error]",n);const a=document.getElementById(t.containerId);a&&(a.innerHTML='\n                <div style="\n                    padding: 24px;\n                    background: #fee;\n                    border: 2px solid #fcc;\n                    border-radius: 8px;\n                    color: #c33;\n                    font-family: -apple-system, sans-serif;\n                    text-align: center;\n                ">\n                    <strong>Widget Error</strong>\n                    <p style="margin: 8px 0 0; font-size: 14px;">\n                        Unable to load advocacy widget. Please refresh the page.\n                    </p>\n                </div>\n            ')}function a(){i("Initializing widget v1.0.0");const e=document.getElementById(t.containerId);if(!e)return void n("Container element not found",new Error("Missing #"+t.containerId));const a=e.dataset.widgetUrl||t.widgetUrl,d=e.dataset.width||t.defaultWidth,o=e.dataset.height||t.defaultHeight,r=e.dataset.campaign||"",s=e.dataset.recipient||"",l=new URLSearchParams;r&&l.append("campaign",r),s&&l.append("recipient",s);const c=a+(l.toString()?"?"+l.toString():"");i("Widget URL: "+c);const p=document.createElement("iframe");p.src=c,p.style.cssText=`\n            width: ${d};\n            height: ${o};\n            border: none;\n            border-radius: ${t.borderRadius};\n            box-shadow: ${t.boxShadow};\n            display: block;\n            max-width: 100%;\n        `,p.setAttribute("scrolling","no"),p.setAttribute("allow","clipboard-write"),p.setAttribute("title","Iran Advocacy Email Widget"),p.setAttribute("loading","lazy"),p.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups"),p.addEventListener("load",(function(){i("Widget loaded successfully"),e.classList.add("widget-loaded")})),p.addEventListener("error",(function(e){n("Failed to load widget",e)})),window.addEventListener("message",(function(e){if(!t.allowedOrigins.some((t=>e.origin===t||e.origin.startsWith(t))))return void i("Rejected message from unauthorized origin: "+e.origin,"warn");if(e.data&&"resize"===e.data.type&&"number"==typeof e.data.height&&e.data.height>0&&(p.style.height=e.data.height+"px",i("Resized to height: "+e.data.height)),e.data&&"analytics"===e.data.type&&(i("Analytics event: "+e.data.event),"function"==typeof gtag)){gtag("event",e.data.event,{event_category:"iran_widget",event_label:e.data.label||""})}})),e.innerHTML="",e.appendChild(p),i("Widget initialized")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a(),"undefined"!=typeof window&&(window.IranWidgetVersion=e)}();
